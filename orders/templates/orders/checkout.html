{% extends 'base.html' %}
{% load static %}

{% block title %}Checkout | Hop & Barley{% endblock %}

{% block content %}
<main class="checkout-page-wrapper">
    <div class="checkout-container">
        <h1 class="checkout-title">Order Details</h1>

        <form method="post" id="checkout-form">
            {% csrf_token %}
            <!-- Shipping Information -->
            <section class="checkout-section">
                <h2 class="checkout-section__title">Shipping information</h2>
                <div class="checkout-form-group">
                    <label for="shipping_address">Shipping address</label>
                    {% if user.city or user.address %}
                    <div class="address-autofill">
                        <button type="button" id="autofill-address" class="button button--secondary button--small"
                                data-city="{{ user.city|default:'' }}" 
                                data-address="{{ user.address|default:'' }}">
                            <i class="fas fa-map-marker-alt"></i> Use my saved address
                        </button>
                    </div>
                    {% endif %}
                    <textarea id="shipping_address" name="shipping_address" 
                              class="Textarea" placeholder="Enter your full shipping address" 
                              rows="3" required></textarea>
                </div>
            </section>

            <!-- Payment Method -->
            <section class="checkout-section">
                <h2 class="checkout-section__title">Payment Method</h2>
                <div class="payment-methods">
                    <div class="payment-option">
                        <input type="radio" id="payment_card" name="payment_method" value="card" checked>
                        <label for="payment_card" class="payment-label">
                            <div>
                                <i class="fas fa-credit-card"></i>
                                <span>Credit/Debit Card</span>
                            </div>
                            <small>Online payment</small>
                        </label>
                    </div>
                    <div class="payment-option">
                        <input type="radio" id="payment_cod" name="payment_method" value="cash_on_delivery">
                        <label for="payment_cod" class="payment-label">
                            <div>
                                <i class="fas fa-money-bill-wave"></i>
                                <span>Cash on Delivery</span>
                            </div>
                            <small>Pay when received</small>
                        </label>
                    </div>
                </div>

                <!-- Card Payment Form (shown when card is selected) -->
                <div id="card-payment-form" class="card-payment-form">
                    <h3 class="card-form-title">Card Information</h3>
                    <div class="card-form-grid">
                        <div class="form-group">
                            <label for="card_number">Card Number</label>
                            <input type="text" id="card_number" name="card_number" 
                                   placeholder="1234 5678 9012 3456" maxlength="19" 
                                   pattern="[0-9\s]{13,19}">
                        </div>
                        <div class="form-group">
                            <label for="card_holder">Cardholder Name</label>
                            <input type="text" id="card_holder" name="card_holder" 
                                   placeholder="John Doe" maxlength="50" pattern="[a-zA-Z\s\-']{2,50}">
                        </div>
                        <div class="form-group">
                            <label for="expiry_date">Expiry Date</label>
                            <input type="text" id="expiry_date" name="expiry_date" 
                                   placeholder="MM/YY" maxlength="5" pattern="[0-9]{2}/[0-9]{2}">
                            <div class="error-message" id="expiry_error">Card has expired</div>
                        </div>
                        <div class="form-group">
                            <label for="cvv">CVV</label>
                            <input type="text" id="cvv" name="cvv" 
                                   placeholder="123" maxlength="3" pattern="[0-9]{3}">
                        </div>
                    </div>
                    <div class="payment-note">
                        <i class="fas fa-lock"></i>
                        <span>This is a demo payment form. No real payment will be processed.</span>
                    </div>
                </div>

                <!-- Cash Payment Info (shown when cash is selected) -->
                <div id="cash-payment-info" class="cash-payment-info" style="display: none;">
                    <div class="payment-info-box">
                        <i class="fas fa-info-circle"></i>
                        <div>
                            <h4>Cash Payment</h4>
                            <p>You will pay when you receive your order. The order will be marked as "Pending" until payment is received.</p>
                        </div>
                    </div>
                </div>
            </section>

            <!-- Order Summary -->
            <section class="checkout-summary">
                <h2 class="checkout-section__title">Order Summary</h2>
                <div class="summary-details">
                    {% for item in cart %}
                    <div class="summary-item">
                        <span>{{ item.name }} Ã— {{ item.quantity }}</span>
                        <span>{{ item.total_price }}</span>
                    </div>
                    {% endfor %}
                    
                    <hr>
                    <div class="summary-total">
                        <p>Total</p>
                        <p>{{ cart.get_total_price }}</p>
                    </div>
                    
                    <button type="submit" class="button button--primary button--pay">
                        Confirm Order
                    </button>
                    
                    <a href="{% url 'orders:cart_detail' %}" class="button button--secondary">
                        Back to Cart
                    </a>
                </div>
            </section>
        </form>
    </div>
</main>

{% endblock %}