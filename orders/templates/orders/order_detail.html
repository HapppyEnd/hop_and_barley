{% extends 'base.html' %}
{% load static %}

{% block title %}Order Details | Hop & Barley{% endblock %}

{% block content %}
<div class="container">
    <div class="order-details-section">
        <div class="order-header">
            <h2>Order #{{ order.id }}</h2>
            <div class="order-status">
                <span class="status-badge status-badge--{{ order.status }}">
                    {% if order.status == 'pending' %}
                        <i class="fas fa-clock"></i> {{ order.get_status_display }}
                    {% elif order.status == 'placed' %}
                        <i class="fas fa-check-circle"></i> {{ order.get_status_display }}
                    {% elif order.status == 'paid' %}
                        <i class="fas fa-credit-card"></i> {{ order.get_status_display }}
                    {% elif order.status == 'shipped' %}
                        <i class="fas fa-shipping-fast"></i> {{ order.get_status_display }}
                    {% elif order.status == 'delivered' %}
                        <i class="fas fa-check-double"></i> {{ order.get_status_display }}
                    {% elif order.status == 'canceled' %}
                        <i class="fas fa-times-circle"></i> {{ order.get_status_display }}
                    {% else %}
                        <i class="fas fa-circle"></i> {{ order.get_status_display }}
                    {% endif %}
                </span>
            </div>
            <p class="order-date">Created: {{ order.created_at|date:"M d, Y H:i" }}</p>
        </div>
        
        <div class="order-content">
            <div class="order-items-section">
                <h3>Order Items</h3>
                <div class="order-items-grid">
                    {% for item in order.items.all %}
                    <div class="order-item-card">
                        <div class="order-item-image">
                            {% if item.product.image %}
                                <img src="{{ item.product.image.url }}" alt="{{ item.product.name }}">
                            {% else %}
                                <img src="{{ item.product.get_image_url }}" alt="{{ item.product.name }}">
                            {% endif %}
                        </div>
                        <div class="order-item-info">
                            <h4 class="order-item-name">{{ item.product.name }}</h4>
                            <p class="order-item-details">
                                <span>Quantity: {{ item.quantity }}</span>
                                <span>Price per unit: {{ item.price }}</span>
                            </p>
                            <p class="order-item-total">Total: {{ item.total }}</p>
                        </div>
                    </div>
                    {% endfor %}
                </div>
            </div>
            
            <div class="order-summary-section">
                <div class="summary-card">
                    <h3>Order Summary</h3>
                    <div class="summary-row">
                        <span>Subtotal:</span>
                        <span>{{ order.total_price }}</span>
                    </div>
                    <div class="summary-row">
                        <span>Shipping:</span>
                        <span>Free</span>
                    </div>
                    <div class="summary-divider"></div>
                    <div class="summary-row summary-total">
                        <span>Total:</span>
                        <span>{{ order.total_price }}</span>
                    </div>
                </div>
                
                <div class="shipping-card">
                    <h3>Shipping Information</h3>
                    <div class="shipping-info">
                        <p><strong>Address:</strong></p>
                        <p>{{ order.shipping_address }}</p>
                    </div>
                </div>
                
                {% if order.status == 'placed' %}
                <div class="status-info-card status-info--placed">
                    <div class="status-info-icon">
                        <i class="fas fa-info-circle"></i>
                    </div>
                    <div class="status-info-content">
                        <h4>Order Confirmed</h4>
                        <p>Your order has been confirmed and is being prepared. You will pay <strong>Cash on Delivery</strong> when you receive your order.</p>
                    </div>
                </div>
                {% elif order.status == 'pending' %}
                <div class="status-info-card status-info--pending">
                    <div class="status-info-icon">
                        <i class="fas fa-clock"></i>
                    </div>
                    <div class="status-info-content">
                        <h4>Order Processing</h4>
                        <p>Your order is being processed. We'll update you soon with the status.</p>
                    </div>
                </div>
                {% elif order.status == 'paid' %}
                <div class="status-info-card status-info--paid">
                    <div class="status-info-icon">
                        <i class="fas fa-check-circle"></i>
                    </div>
                    <div class="status-info-content">
                        <h4>Payment Received</h4>
                        <p>Thank you! Your payment has been received and we're preparing your order for shipment.</p>
                    </div>
                </div>
                {% elif order.status == 'shipped' %}
                <div class="status-info-card status-info--shipped">
                    <div class="status-info-icon">
                        <i class="fas fa-shipping-fast"></i>
                    </div>
                    <div class="status-info-content">
                        <h4>Order Shipped</h4>
                        <p>Great news! Your order is on its way. You should receive it soon.</p>
                    </div>
                </div>
                {% elif order.status == 'delivered' %}
                <div class="status-info-card status-info--delivered">
                    <div class="status-info-icon">
                        <i class="fas fa-check-double"></i>
                    </div>
                    <div class="status-info-content">
                        <h4>Order Delivered</h4>
                        <p>Your order has been successfully delivered. Thank you for your purchase!</p>
                    </div>
                </div>
                {% elif order.status == 'canceled' %}
                <div class="status-info-card status-info--canceled">
                    <div class="status-info-icon">
                        <i class="fas fa-times-circle"></i>
                    </div>
                    <div class="status-info-content">
                        <h4>Order Canceled</h4>
                        <p>This order has been canceled. If you have any questions, please contact us.</p>
                    </div>
                </div>
                {% endif %}
                
                <div class="order-actions">
                    {% if order.status in 'pending,placed,paid' %}
                    <form method="post" action="{% url 'orders:cancel_order' order.id %}" 
                          style="display: inline-block; margin-right: 10px;"
                          onsubmit="return confirm('Are you sure you want to cancel this order?')">
                        {% csrf_token %}
                        <button type="submit" class="button button--danger">
                            <i class="fas fa-times"></i> Cancel Order
                        </button>
                    </form>
                    {% endif %}
                    
                    <a href="{% url 'users:account' %}" class="button button--secondary">
                        <i class="fas fa-arrow-left"></i> Back to Account
                    </a>
                </div>
            </div>
        </div>
    </div>
</div>
{% endblock %}
